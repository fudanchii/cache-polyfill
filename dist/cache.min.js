!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cachePolyfill={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){i=!0,c=e},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw c}}}}var i=new WeakMap,s=function(e){return i.get(e)},l=function(e,t){if(t.length<e)throw new TypeError("".concat(e," argument required, but only ").concat(t.length," present."))},f=function(e){return e&&e instanceof Request};function h(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var d=function(){function e(r){t(this,e),i.set(this,r)}return n(e,[{key:"match",value:async function(){return(await this.matchAll.apply(this,arguments))[0]}},{key:"matchAll",value:async function(e){if("HEAD"===e.method)return[];var t=s(this),r=await h(),n=[],a=r.transaction("caches","readonly");return a.objectStore("caches").index("cacheName").openCursor(IDBKeyRange.only(t)).onsuccess=function(){var t=this.result;if(t){if((e.url||e)===t.value.reqUrl){var r=Object.assign({url:t.value.resUrl},t.value),a=new Response(t.value.body,r);n.push(a)}t.continue()}},new Promise((function(e){return a.oncomplete=function(){return e(n)}}))}},{key:"add",value:async function(e){return l(1,arguments),this.addAll([e])}},{key:"addAll",value:async function(e){var t=this;l(1,arguments);var r,n=[],o=u(e);try{var c=async function(){var e=r.value;if(e=new Request(e),!/^((http|https):\/\/)/.test(e.url))throw new TypeError('Add/AddAll does not support schemes other than "http" or "https"');if("GET"!==e.method)throw new TypeError("Add/AddAll only supports the GET request method");var t=e.clone();await fetch(t).then((function(t){if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");if(!t.ok)throw new TypeError("Request failed");n.push([e,t])}))};for(o.s();!(r=o.n()).done;)await c()}catch(e){o.e(e)}finally{o.f()}await Promise.all(n.map((function(e){return t.put.apply(t,a(e))})))}},{key:"put",value:async function(e,t){if(l(2,arguments),e=f(e)?e:new Request(e),await this.delete(e),!/^((http|https):\/\/)/.test(e.url))throw new TypeError("Request scheme '".concat(e.url.split(":")[0],"' is unsupported"));if("GET"!==e.method)throw new TypeError("Request method '".concat(e.method,"' is unsupported"));if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");var r=t.headers.get("Vary");if(r&&r.includes("*"))throw new TypeError("Vary header contains *");if(null!=t.body&&t.bodyUsed)throw new TypeError("Response body is already used");var n=s(this),o={cacheName:n,headers:a(t.headers.entries()),status:t.status,statusText:t.statusText,body:await t.arrayBuffer(),reqUrl:e.url.replace(/#.*$/,""),resUrl:t.url.replace(/#.*$/,""),reqMethod:e.method},c=await h();await new Promise((function(e,t){var r=c.transaction("caches","readwrite");r.objectStore("caches").put(o),r.oncomplete=function(){return e()},r.onerror=function(){return t(r.error)}}))}},{key:"delete",value:async function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(1,arguments);var r=s(this),n=t.ignoreMethod,a=f(e)?e:new Request(e);if(!["GET","HEAD"].includes(a.method)&&n)return!1;var o=a.method,c=a.url.replace(/#.*$/,""),u=await h(),i=u.transaction("caches","readwrite"),d=i.objectStore("caches"),y=d.index("cacheName"),p=y.openCursor(IDBKeyRange.only(r)),v=!1;return p.onsuccess=function(){var e=this.result;e&&(c!==e.value.reqUrl||!n&&o!==e.value.reqMethod||(v=!0,d.delete(e.primaryKey)),e.continue())},new Promise((function(e){return i.oncomplete=function(){return e(v)}}))}},{key:"keys",value:async function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(this),a=r.ignoreMethod,o=void 0!==a&&a,c=r.ignoreSearch,u=void 0!==c&&c;if(void 0!==e&&(e=new Request(e),t=e.url.split("#")[0],"GET"!==e.method&&!o))return[];var i=void 0===e?function(e){return e}:function(e){return e.filter((function(e){return u?(e=e.reqUrl.split("?")[0],t=t.split("?")[0]):e=e.reqUrl,e===t}))},l=await h(),f=await new Promise((function(e){var t=l.transaction("caches","readonly").objectStore("caches").index("cacheName").getAll(IDBKeyRange.only(n));t.onsuccess=function(){return e(t.result)}}));return i(f).map((function(e){return new Request(e.reqUrl)}))}}]),e}();function y(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var p=function(){function e(){t(this,e)}return n(e,[{key:"delete",value:async function(e){if(!(await this.keys()).includes(e))return!1;var t=(await y()).transaction(["storages","caches"],"readwrite");t.objectStore("storages").delete(e);var r=t.objectStore("caches");return r.index("cacheName").getAllKeys(IDBKeyRange.only(e)).onsuccess=function(e){var t,n=u(this.result);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.delete(a)}}catch(e){n.e(e)}finally{n.f()}},new Promise((function(e,r){t.oncomplete=function(){return e(!0)},t.onerror=function(){return r(!1)}}))}},{key:"has",value:function(e){return this.keys().then((function(t){return t.includes(e)}))}},{key:"keys",value:async function(){var e=(await y()).transaction("storages","readonly").objectStore("storages").getAllKeys();return new Promise((function(t){return e.onsuccess=function(){return t(e.result)}}))}},{key:"match",value:async function(){var e,t=await this.keys(),r=u(t);try{for(r.s();!(e=r.n()).done;){var n=e.value,a=await this.open(n),o=await a.match.apply(a,arguments);if(o)return o}}catch(e){r.e(e)}finally{r.f()}}},{key:"open",value:async function(e){if(arguments.length<1)throw new TypeError("".concat(arguments.length," argument required, but only ").concat(arguments.length," present."));var t=await y();return await new Promise((function(r,n){var a=t.transaction("storages","readwrite");a.objectStore("storages").put({cacheName:e}),a.oncomplete=function(){return r()},a.onerror=function(){return n(a.error)}})),new d(e)}},{key:Symbol.toStringTag,value:function(){return"CacheStorage"}}]),e}(),v={Cache:d,CacheStorage:p,caches:window.caches||new p},w=v.Cache,m=v.CacheStorage,g=v.caches;e.Cache=w,e.CacheStorage=m,e.__moduleExports=v,e.caches=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cache.min.js.map
